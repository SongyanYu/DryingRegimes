xlab("Number of Events")+
ylab("Drying Duration\n(day)") +
scale_fill_viridis(limit=c(0,120))
n_events = n_events + geom_point(data=region.mean,aes(x=mean.dry.date,y=mean.n_events,group=paste(Name,CLASS),color=Name,shape = factor(CLASS)),size = 4, alpha=.75)+
scale_color_manual(values = pal_regions)
N_events
n_events
########## Define Colors
pal_regions <-
c("Eastern Forests" = "#009E73",
"Mediterranean California" = "#F0E442",
"Northern Great Plains" = "#0072B2",
"Southern Great Plains" = "#E69F00",
"Western Deserts" = "#D55E00",
"Western Mountains" = "#56B4E9")
n_events = ggplot(dat,aes(x=dry_date_start,y = n_events)) +
geom_bin2d(binwidth = c(5,5)) +
# ylim(0,365) +
xlab("Number of Events")+
ylab("Drying Duration\n(day)") +
scale_fill_viridis(limit=c(0,120))
n_events
n_events
dat$n
n_events = ggplot(dat,aes(x=dry_date_start,y = n)) +
geom_bin2d(binwidth = c(5,5)) +
# ylim(0,365) +
xlab("Number of Events")+
ylab("Drying Duration\n(day)") +
scale_fill_viridis(limit=c(0,120))
n_events
n_events = ggplot(dat,aes(x=dry_date_start,y = n)) +
geom_bin2d(binwidth = c(5,2)) +
# ylim(0,365) +
xlab("Dry Start Date (day)")+
ylab("Number of Events") +
scale_fill_viridis(limit=c(0,120))
n_events
n_events = ggplot(dat,aes(x=dry_date_start,y = n)) +
geom_bin2d(binwidth = c(5,5)) +
# ylim(0,365) +
xlab("Dry Start Date (day)")+
ylab("Number of Events") +
scale_fill_viridis(limit=c(0,120))
n_events = n_events + geom_point(data=region.mean,aes(x=mean.dry.date,y=mean.n_events,group=paste(Name,CLASS),color=Name,shape = factor(CLASS)),size = 4, alpha=.75)+
scale_color_manual(values = pal_regions)
n_events
binned  = drying_rate + peak2zero  + n_events + dry_dur
binned
region.mean  = dat.mean %>% group_by(Name,CLASS)%>%
select(Name,CLASS,mean_dry_date_start,mean_drying_rate,mean_peak2zero,mean_dry_dur,n_events) %>%
summarise(.,mean.dry.date = mean(mean_dry_date_start),
mean.drying.rate = mean(mean_drying_rate),
mean.peak2zero = mean(mean_peak2zero),
mean.dry_dur = mean(mean_dry_dur),
mean.n_events = mean(n_events)
)
drying_rate = ggplot(dat,aes(x=dry_date_start,y = drying_rate))+
geom_bin2d(binwidth = c(5, 0.15))+
xlab("Dry Start Date (day)")+
ylab("Drying Rate\n(1/day)") +
scale_fill_viridis(limit=c(0,120))
drying_rate = drying_rate + geom_point(data=region.mean,aes(x=mean.dry.date,y=mean.drying.rate,group=paste(Name,CLASS),color=Name,shape = factor(CLASS)),size = 4, alpha=.75)+
scale_color_manual(values = pal_regions)
peak2zero = ggplot(dat,aes(x=dry_date_start,y = peak2zero))+
geom_bin2d(binwidth = c(5,5)) +
ylim(0,365)+
xlab("Dry Start Date (day)")+
ylab("Peak2Zero\n(day)") +
scale_fill_viridis(limit=c(0,120))
peak2zero = peak2zero + geom_point(data=region.mean,aes(x=mean.dry.date,y=mean.peak2zero,group=paste(Name,CLASS),color=Name,shape = factor(CLASS)),size = 4, alpha=.75)+
scale_color_manual(values = pal_regions)
dry_dur = ggplot(dat,aes(x=dry_date_start,y = dry_dur)) +
geom_bin2d(binwidth = c(5,5)) +
ylim(0,365) +
xlab("Dry Start Date (day)")+
ylab("Drying Duration\n(day)") +
scale_fill_viridis(limit=c(0,120))
dry_dur = dry_dur + geom_point(data=region.mean,aes(x=mean.dry.date,y=mean.dry_dur,group=paste(Name,CLASS),color=Name,shape = factor(CLASS)),size = 4, alpha=.75)+
scale_color_manual(values = pal_regions)
n_events = ggplot(dat,aes(x=dry_date_start,y = n)) +
geom_bin2d(binwidth = c(5,5)) +
# ylim(0,365) +
xlab("Dry Start Date (day)")+
ylab("Number of Events") +
scale_fill_viridis(limit=c(0,120))
n_events = n_events + geom_point(data=region.mean,aes(x=mean.dry.date,y=mean.n_events,group=paste(Name,CLASS),color=Name,shape = factor(CLASS)),size = 4, alpha=.75)+
scale_color_manual(values = pal_regions)
binned  = drying_rate + peak2zero  + n_events + dry_dur
binned
n_events = ggplot(dat,aes(x=dry_date_start,y = n)) +
geom_bin2d(binwidth = c(5,10)) +
# ylim(0,365) +
xlab("Dry Start Date (day)")+
ylab("Number of Events") +
scale_fill_viridis(limit=c(0,120))
n_events = n_events + geom_point(data=region.mean,aes(x=mean.dry.date,y=mean.n_events,group=paste(Name,CLASS),color=Name,shape = factor(CLASS)),size = 4, alpha=.75)+
scale_color_manual(values = pal_regions)
binned  = drying_rate + peak2zero  + n_events + dry_dur
binned
binned  = drying_rate + peak2zero  + n_events + dry_dur  plot_layout(ncol = 4)
binned
binned  = drying_rate + peak2zero  + n_events + dry_dur + plot_layout(ncol = 4)
binned
binned  = drying_rate + peak2zero  + n_events + dry_dur + plot_layout(ncol = 4, guides = "collect") & theme(legend.position = 'right')
binned
n_events = ggplot(dat,aes(x=dry_date_start,y = n)) +
geom_bin2d(binwidth = c(5,7)) +
# ylim(0,365) +
xlab("Dry Start Date (day)")+
ylab("Number of Events") +
scale_fill_viridis(limit=c(0,120))
n_events = n_events + geom_point(data=region.mean,aes(x=mean.dry.date,y=mean.n_events,group=paste(Name,CLASS),color=Name,shape = factor(CLASS)),size = 4, alpha=.75)+
scale_color_manual(values = pal_regions)
binned  = drying_rate + peak2zero  + n_events + dry_dur + plot_layout(ncol = 4, guides = "collect") & theme(legend.position = 'right')
binned
factor(dat$CLASS)
n_events = n_events + geom_point(data=region.mean,aes(x=mean.dry.date,y=mean.n_events,group=paste(Name,CLASS),color=Name,shape = factor(CLASS)+20),size = 4, alpha=.75)+
scale_color_manual(values = pal_regions)
n_events = n_events + geom_point(data=region.mean,aes(x=mean.dry.date,y=mean.n_events,group=paste(Name,CLASS),color=Name,shape = factor(CLASS)+20),size = 4, alpha=.75)+
scale_color_manual(values = pal_regions)
binned  = drying_rate + peak2zero  + n_events + dry_dur + plot_layout(ncol = 4, guides = "collect") & theme(legend.position = 'right')
binned
n_events = n_events +
geom_point(data=region.mean,aes(x=mean.dry.date,y=mean.n_events,group=paste(Name,CLASS),fill=Name,shape = factor(CLASS)),colour="white",size = 4, alpha=.75)+
scale_color_manual(values = pal_regions)
n_events = n_events +
geom_point(data=region.mean,aes(x=mean.dry.date,y=mean.n_events,group=paste(Name,CLASS),shape = factor(CLASS)+20),colour="white",size = 5, alpha=.75)+
geom_point(data=region.mean,aes(x=mean.dry.date,y=mean.n_events,group=paste(Name,CLASS),color=Name,shape = factor(CLASS)+20),size = 4, alpha=.75)+
scale_color_manual(values = pal_regions)+
aes(fill=id),
colour="black",pch=21, size=5))
n_events = n_events +
geom_point(data=region.mean,aes(x=mean.dry.date,y=mean.n_events,group=paste(Name,CLASS),shape = factor(CLASS)+20),colour="white",size = 5, alpha=.75)+
geom_point(data=region.mean,aes(x=mean.dry.date,y=mean.n_events,group=paste(Name,CLASS),color=Name,shape = factor(CLASS)+20),size = 4, alpha=.75)+
scale_color_manual(values = pal_regions)
n_events
n_events = n_events +
geom_point(data=region.mean,aes(x=mean.dry.date,y=mean.n_events,group=paste(Name,CLASS),shape = factor(CLASS)+20),colour="white",size = 5, alpha=.75)+
geom_point(data=region.mean,aes(x=mean.dry.date,y=mean.n_events,group=paste(Name,CLASS),color=Name,shape = factor(CLASS)+20),size = 4, alpha=.75)+
scale_color_manual(values = pal_regions)
n_events = n_events + geom_point(data=region.mean,aes(x=mean.dry.date,y=mean.n_events,group=paste(Name,CLASS),shape = factor(CLASS)+20),colour="white",size = 5, alpha=.75)+
geom_point(data=region.mean,aes(x=mean.dry.date,y=mean.n_events,group=paste(Name,CLASS),color=Name,shape = factor(CLASS)+20),size = 4, alpha=.75)+
scale_color_manual(values = pal_regions)
n_events = n_events +
geom_point(data=region.mean,aes(x=mean.dry.date,y=mean.n_events,group=paste(Name,CLASS),shape = factor(CLASS)+20),colour="white",size = 5, alpha=.75)
n_events
n_events = n_events +
geom_point(data=region.mean,aes(x=mean.dry.date,y=mean.n_events,group=paste(Name,CLASS),shape = factor(CLASS)),colour="white",size = 5, alpha=.75)
n_events
n_events = n_events +
geom_point(data=region.mean,aes(x=mean.dry.date,y=mean.n_events,group=paste(Name,CLASS),shape = factor(CLASS)),colour="white",size = 5, alpha=.75)
n_events = ggplot(dat,aes(x=dry_date_start,y = n)) +
geom_bin2d(binwidth = c(5,7)) +
# ylim(0,365) +
xlab("Dry Start Date (day)")+
ylab("Number of Events") +
scale_fill_viridis(limit=c(0,120))
n_events = n_events +
geom_point(data=region.mean,aes(x=mean.dry.date,y=mean.n_events,group=paste(Name,CLASS),shape = factor(CLASS)),colour="white",size = 5, alpha=.75)
n_events
n_events+geom_point(data=region.mean,aes(x=mean.dry.date,y=mean.n_events,group=paste(Name,CLASS),color=Name,shape = factor(CLASS)+20),size = 4, alpha=.75)+
scale_color_manual(values = pal_regions)
n_events+geom_point(data=region.mean,aes(x=mean.dry.date,y=mean.n_events,group=paste(Name,CLASS),color=Name,shape = factor(CLASS)),size = 4, alpha=.75)+
scale_color_manual(values = pal_regions)
drying_rate = ggplot(dat,aes(x=dry_date_start,y = drying_rate))+
geom_bin2d(binwidth = c(5, 0.15))+
xlab("Dry Start Date (day)")+
ylab("Drying Rate\n(1/day)") +
scale_fill_viridis(limit=c(0,120))
# scale_fill_gradientn(trans = 'log',labels=trans_format("identity", function(x) round(x,2)),limits = c(1,300),colors = viridis(10),breaks =c(1,10,50,100,200))
drying_rate = drying_rate +
geom_point(data=region.mean,aes(x=mean.dry.date,y=mean.drying_rate,group=paste(Name,CLASS),shape = factor(CLASS)),colour="white",size = 5, alpha=.75)
drying_rate = drying_rate + geom_point(data=region.mean,aes(x=mean.dry.date,y=mean.drying.rate,group=paste(Name,CLASS),color=Name,shape = factor(CLASS)),size = 4, alpha=.75)+
scale_color_manual(values = pal_regions)
peak2zero = ggplot(dat,aes(x=dry_date_start,y = peak2zero))+
geom_bin2d(binwidth = c(5,5)) +
ylim(0,365)+
xlab("Dry Start Date (day)")+
ylab("Peak2Zero\n(day)") +
scale_fill_viridis(limit=c(0,120))
peak2zero = peak2zero +
geom_point(data=region.mean,aes(x=mean.dry.date,y=mean.peak2zero,group=paste(Name,CLASS),shape = factor(CLASS)),colour="white",size = 5, alpha=.75)
peak2zero = peak2zero + geom_point(data=region.mean,aes(x=mean.dry.date,y=mean.peak2zero,group=paste(Name,CLASS),color=Name,shape = factor(CLASS)),size = 4, alpha=.75)+
scale_color_manual(values = pal_regions)
dry_dur = ggplot(dat,aes(x=dry_date_start,y = dry_dur)) +
geom_bin2d(binwidth = c(5,5)) +
ylim(0,365) +
xlab("Dry Start Date (day)")+
ylab("Drying Duration\n(day)") +
scale_fill_viridis(limit=c(0,120))
dry_dur = dry_dur +
geom_point(data=region.mean,aes(x=mean.dry.date,y=mean.dry_dur,group=paste(Name,CLASS),shape = factor(CLASS)),colour="white",size = 5, alpha=.75)
dry_dur = dry_dur + geom_point(data=region.mean,aes(x=mean.dry.date,y=mean.dry_dur,group=paste(Name,CLASS),color=Name,shape = factor(CLASS)),size = 4, alpha=.75)+
scale_color_manual(values = pal_regions)
n_events = ggplot(dat,aes(x=dry_date_start,y = n)) +
geom_bin2d(binwidth = c(5,7)) +
# ylim(0,365) +
xlab("Dry Start Date (day)")+
ylab("Number of Events") +
scale_fill_viridis(limit=c(0,120))
n_events = n_events +
geom_point(data=region.mean,aes(x=mean.dry.date,y=mean.n_events,group=paste(Name,CLASS),shape = factor(CLASS)),colour="white",size = 5, alpha=.75)
n_events = n_events+geom_point(data=region.mean,aes(x=mean.dry.date,y=mean.n_events,group=paste(Name,CLASS),color=Name,shape = factor(CLASS)),size = 4, alpha=.75)+
scale_color_manual(values = pal_regions)
binned  = drying_rate + peak2zero  + n_events + dry_dur + plot_layout(ncol = 4, guides = "collect") & theme(legend.position = 'right')
binned
drying_rate = ggplot(dat,aes(x=dry_date_start,y = drying_rate))+
geom_bin2d(binwidth = c(5, 0.15))+
xlab("Dry Start Date (day)")+
ylab("Drying Rate\n(1/day)") +
scale_fill_viridis(limit=c(0,120))
# scale_fill_gradientn(trans = 'log',labels=trans_format("identity", function(x) round(x,2)),limits = c(1,300),colors = viridis(10),breaks =c(1,10,50,100,200))
drying_rate = drying_rate +
geom_point(data=region.mean,aes(x=mean.dry.date,y=mean.drying.rate,group=paste(Name,CLASS),shape = factor(CLASS)),colour="white",size = 5, alpha=.75)
drying_rate = drying_rate + geom_point(data=region.mean,aes(x=mean.dry.date,y=mean.drying.rate,group=paste(Name,CLASS),color=Name,shape = factor(CLASS)),size = 4, alpha=.75)+
scale_color_manual(values = pal_regions)
peak2zero = ggplot(dat,aes(x=dry_date_start,y = peak2zero))+
geom_bin2d(binwidth = c(5,5)) +
ylim(0,365)+
xlab("Dry Start Date (day)")+
ylab("Peak2Zero\n(day)") +
scale_fill_viridis(limit=c(0,120))
peak2zero = peak2zero +
geom_point(data=region.mean,aes(x=mean.dry.date,y=mean.peak2zero,group=paste(Name,CLASS),shape = factor(CLASS)),colour="white",size = 5, alpha=.75)
peak2zero = peak2zero + geom_point(data=region.mean,aes(x=mean.dry.date,y=mean.peak2zero,group=paste(Name,CLASS),color=Name,shape = factor(CLASS)),size = 4, alpha=.75)+
scale_color_manual(values = pal_regions)
dry_dur = ggplot(dat,aes(x=dry_date_start,y = dry_dur)) +
geom_bin2d(binwidth = c(5,5)) +
ylim(0,365) +
xlab("Dry Start Date (day)")+
ylab("Drying Duration\n(day)") +
scale_fill_viridis(limit=c(0,120))
dry_dur = dry_dur +
geom_point(data=region.mean,aes(x=mean.dry.date,y=mean.dry_dur,group=paste(Name,CLASS),shape = factor(CLASS)),colour="white",size = 5, alpha=.75)
dry_dur = dry_dur + geom_point(data=region.mean,aes(x=mean.dry.date,y=mean.dry_dur,group=paste(Name,CLASS),color=Name,shape = factor(CLASS)),size = 4, alpha=.75)+
scale_color_manual(values = pal_regions)
n_events = ggplot(dat,aes(x=dry_date_start,y = n)) +
geom_bin2d(binwidth = c(5,7)) +
# ylim(0,365) +
xlab("Dry Start Date (day)")+
ylab("Number of Events") +
scale_fill_viridis(limit=c(0,120))
n_events = n_events +
geom_point(data=region.mean,aes(x=mean.dry.date,y=mean.n_events,group=paste(Name,CLASS),shape = factor(CLASS)),colour="white",size = 5, alpha=.75)
n_events = n_events+geom_point(data=region.mean,aes(x=mean.dry.date,y=mean.n_events,group=paste(Name,CLASS),color=Name,shape = factor(CLASS)),size = 4, alpha=.75)+
scale_color_manual(values = pal_regions)
binned  = drying_rate + peak2zero  + n_events + dry_dur + plot_layout(ncol = 4, guides = "collect") & theme(legend.position = 'right')
binned
hist(dat$peak_quantile/dat$q50)
dat$peak_quantile/dat$q50
noflow.quant = dat %>% group_by(gage) %>% summarise(.,yy = quantile(dry_dur))
sev = ggplot(data=dat, aes(x = (dry_dur*peak_quantile)/n),y=Name,group=paste(Name,CLASS),fill=Name,linetype=CLASS)) +
plot_lay()
sev = ggplot(data=dat, aes(x = (dry_dur*peak_quantile)/n,y=Name,group=paste(Name,CLASS),fill=Name,linetype=CLASS)) +
plot_lay()
sev
sev = ggplot(data=dat, aes(x = log((dry_dur*peak_quantile)/n),y=Name,group=paste(Name,CLASS),fill=Name,linetype=CLASS)) +
plot_lay()
sev
##################### Density Based Clustering #########################
library(fpc)
library(dbscan)
install.packages('dbscan')
library(dbscan)
library(factoextra)
## load up the packages we will need:  (uncomment as required)
library(tidyverse)
library(mclust)
library(ggplot2)
library(mapdata)
library(rwrfhydro)
library(ggfortify)
library(plotly)
library(ClusterR)
library(cluster)
library(factoextra)
### Load Data
dat = read.csv("../data/metrics_by_event_combined.csv")
dat$Name[dat$Name == "Ignore"] = "Mediterranean California"
dat = dat[dat$peak_quantile>.25,]
dat.metrics = dat %>% select(gage,peak2zero,drying_rate,dry_date_start,dry_dur)
dbscan(dat.metrics[,-1],eps=0.15,minPts = 5,scale=T)
library(dbscan)
fpc::dbscan(dat.metrics[,-1],eps=0.15,minPts = 5,scale = T)
fpc::dbscan(dat.metrics[,-1],eps=0.15,MinPts = 5,scale = T)
db = fpc::dbscan(dat.metrics[,-1],eps=0.15,MinPts = 5,scale = T)
fviz_cluster(db,dat.metrics[,-1], stand = FALSE, frame = FALSE, geom = "point")
db = fpc::dbscan(dat.metrics[,-1],eps=0.15,MinPts = 50,scale = T)
db
fviz_cluster(db,dat.metrics[,-1], stand = FALSE, frame = FALSE, geom = "point")
fviz_cluster(db, stand = FALSE, frame = FALSE, geom = "point")
fviz_cluster(db, stand = FALSE, frame = FALSE, geom = "point")
fviz_cluster(db, stand = FALSE, geom = "point")
fviz_cluster(db, dat.metrics[,-1],stand = FALSE, geom = "point")
fviz_cluster(db, dat.metrics[,-1],stand = FALSE)
############## PCA ############
PCA = prcomp(dat.scale)
autoplot(PCA,loadings=T,loadings.label=T)
############## PCA ############
PCA = prcomp(dat.scale)
dat.scale = scale(dat.metrics[,-1])
############## PCA ############
PCA = prcomp(dat.scale)
autoplot(PCA,loadings=T,loadings.label=T)
db = fpc::dbscan(dat.scale,eps=0.15,MinPts = 50,scale = T)
fviz_cluster(db, dat.scale,stand = FALSE)
plot(db, dat.scale, main = "DBSCAN", frame = FALSE)
fviz_cluster(db, dat.scale,stand = FALSE)
fviz_cluster(db, dat.scale, stand = FALSE, frame = FALSE, geom = "point")
fviz_cluster(db, dat.scale, stand = FALSE, ellipse = FALSE, geom = "point")
fviz_cluster( dat.scale, db,stand = FALSE, ellipse = FALSE, geom = "point")
fviz_cluster(dat.scale, db,stand = FALSE, ellipse = FALSE, geom = "point")
fviz_cluster(db,dat.scale, stand = FALSE, ellipse = FALSE, geom = "point")
fviz_cluster(db,dat.scale, stand = FALSE, ellipse = FALSE, geom = "point",show.clust.cent = T)
fviz_cluster(db,dat.scale, stand = FALSE, ellipse = FALSE, geom = "point",show.clust.cent = T,pointsize = .1)
db
db$cluster
tt = cbind(dat.scale,db$cluster)
db$cluster
tt = cbind(dat.scale,array(db$cluster))
tt = cbind(as.data.frame(dat.scale),array(db$cluster))
autoplot(PCA,colour = as.factor(tt$`array(db$cluster)`),scale = 0,loadings=T)
autoplot(PCA,colour = as.factor(tt$`array(db$cluster)`),loadings=T)
autoplot(PCA,loadings=T)
autoplot(PCA,loadings=T,color = factor(db$cluster))
autoplot(PCA,loadings=T,colour = as.factor(db$cluster))
autoplot(PCA,loadings=T,color = as.factor(db$cluster))
autoplot(PCA,loadings=T,colour = as.factor(db$cluster))
## PCA Plot
autoplot(PCA,colour = as.factor(pr$cluster_labels+1),scale = 0,loadings=T)
ggplot(PCA,aes(x=PC1,y=PC2, colour = as.factor(pr$cluster_labels)))+
geom_point()+
stat_ellipse()
ggplot(PCA,aes(x=PC1,y=PC2, colour = as.factor(tt$`array(db$cluster)`)))+
geom_point()+
stat_ellipse()
db = fpc::dbscan(dat.scale,eps=0.15,MinPts = 25,scale = T)
db
tt = cbind(as.data.frame(dat.scale),array(db$cluster))
ggplot(PCA,aes(x=PC1,y=PC2, colour = as.factor(tt$`array(db$cluster)`)))+
geom_point()+
stat_ellipse()
db = fpc::dbscan(dat.scale,eps=1,MinPts = 25,scale = T)
### Load Data
dat = read.csv("../data/metrics_by_event_combined.csv")
dat$Name[dat$Name == "Ignore"] = "Mediterranean California"
dat = dat[dat$peak_quantile>.25,]
dat = dat %>% group_by(gage) %>% count() %>% left_join(dat,.,by="gage")
dat.metrics = dat %>% select(gage,peak2zero,drying_rate,dry_date_start,dry_dur,n)
dat.scale = scale(dat.metrics[,-1])
############## PCA ############
PCA = prcomp(dat.scale)
autoplot(PCA,loadings=T,loadings.label=T)
dat.metrics = dat %>% select(gage,peak2zero,drying_rate,dry_date_start,n)
dat.scale = scale(dat.metrics[,-1])
############## PCA ############
PCA = prcomp(dat.scale)
autoplot(PCA,loadings=T,loadings.label=T)
# Visualize eigenvalues/variances
fviz_screeplot(PCA, addlabels = TRUE, ylim = c(0, 50))
dat.metrics = dat %>% select(gage,peak2zero,drying_rate,dry_date_start,dry_dur,n)
dat.scale = scale(dat.metrics[,-1])
############## PCA ############
PCA = prcomp(dat.scale)
autoplot(PCA,loadings=T,loadings.label=T)
# Visualize eigenvalues/variances
fviz_screeplot(PCA, addlabels = TRUE, ylim = c(0, 50))
db = fpc::dbscan(dat.scale,eps=1,MinPts = 25,scale = T)
fviz_cluster(db,dat.scale, stand = FALSE, ellipse = FALSE, geom = "point",show.clust.cent = T,pointsize = .1)
db
db = fpc::dbscan(dat.scale,eps=1,MinPts = 50,scale = T)
fviz_cluster(db,dat.scale, stand = FALSE, ellipse = FALSE, geom = "point",show.clust.cent = T,pointsize = .1)
db
db = fpc::dbscan(dat.scale,eps=1,MinPts = 15,scale = T)
fviz_cluster(db,dat.scale, stand = FALSE, ellipse = FALSE, geom = "point",show.clust.cent = T,pointsize = .1)
tt = cbind(as.data.frame(dat.scale),array(db$cluster))
ggplot(PCA,aes(x=PC1,y=PC2, colour = as.factor(tt$`array(db$cluster)`)))+
geom_point()+
stat_ellipse()
kNNdistplot(dat.scale)
kNNdistplot(dat.scale,k = ln(length(dat.scale)))
kNNdistplot(dat.scale,k = log(length(dat.scale)))
kNNdistplot(dat.scale,k = log(length(dat.scale)))
db = fpc::dbscan(dat.scale,eps=2,MinPts = 15,scale = T)
db = fpc::dbscan(dat.scale,eps=2,MinPts = log(length(dat.scale)))
fviz_cluster(db,dat.scale, stand = FALSE, ellipse = FALSE, geom = "point",show.clust.cent = T,pointsize = .1)
db = fpc::dbscan(dat.scale,eps=.5,MinPts = log(length(dat.scale)))
fviz_cluster(db,dat.scale, stand = FALSE, ellipse = FALSE, geom = "point",show.clust.cent = T,pointsize = .1)
fviz_cluster(db,dat.scale, stand = FALSE, ellipse = FALSE, geom = "point",show.clust.cent = T,pointsize = .5)
tt = cbind(as.data.frame(dat.scale),array(db$cluster))
ggplot(PCA,aes(x=PC1,y=PC2, colour = as.factor(tt$`array(db$cluster)`)))+
geom_point()+
stat_ellipse()
fviz_cluster(db,dat.scale, stand = FALSE, ellipse = FALSE, geom = "point",show.clust.cent = T,pointsize = .5)
autoplot(PCA,loadings=T,loadings.label=T)
dat.metrics$dry_date_start = 2*pi*(dat.metrics$dry_date_start/365)
dat.scale = scale(dat.metrics[,-1])
############## PCA ############
PCA = prcomp(dat.scale)
autoplot(PCA,loadings=T,loadings.label=T)
dat.metrics = dat %>% select(gage,peak2zero,drying_rate,dry_date_start,dry_dur,n)
dat.metrics$dry_date_start = sin(2*pi*(dat.metrics$dry_date_start/365))
dat.scale = scale(dat.metrics[,-1])
############## PCA ############
PCA = prcomp(dat.scale)
autoplot(PCA,loadings=T,loadings.label=T)
dat.metrics = dat %>% select(gage,peak2zero,drying_rate,dry_date_start,dry_dur,n)
dat.metrics$dry_date_start = sos(2*pi*(dat.metrics$dry_date_start/365))
dat.scale = scale(dat.metrics[,-1])
dat.metrics$dry_date_start = cos(2*pi*(dat.metrics$dry_date_start/365))
dat.scale = scale(dat.metrics[,-1])
############## PCA ############
PCA = prcomp(dat.scale)
autoplot(PCA,loadings=T,loadings.label=T)
dat.metrics = dat %>% select(gage,peak2zero,drying_rate,dry_date_start,n)
# dat.metrics$dry_date_start = cos(2*pi*(dat.metrics$dry_date_start/365))
dat.scale = scale(dat.metrics[,-1])
############## PCA ############
PCA = prcomp(dat.scale)
autoplot(PCA,loadings=T,loadings.label=T)
dat.metrics$dry_date_start = sin(2*pi*(dat.metrics$dry_date_start/365))
dat.scale = scale(dat.metrics[,-1])
############## PCA ############
PCA = prcomp(dat.scale)
autoplot(PCA,loadings=T,loadings.label=T)
dat.metrics = dat %>% select(gage,peak2zero,drying_rate,dry_date_start,n)
# dat.metrics$dry_date_start = sin(2*pi*(dat.metrics$dry_date_start/365))
dat.scale = scale(dat.metrics[,-1])
############## PCA ############
PCA = prcomp(dat.scale)
autoplot(PCA,loadings=T,loadings.label=T)
# Visualize eigenvalues/variances
fviz_screeplot(PCA, addlabels = TRUE, ylim = c(0, 50))
### Load Data
dat = read.csv("../data/metrics_by_event_combined.csv")
getwd()
setwd("/Volumes/GoogleDrive/My Drive/12_subprojects/DryingRegimes/code")
### Load Data
dat = read.csv("../data/metrics_by_event_combined.csv")
dat$Name[dat$Name == "Ignore"] = "Mediterranean California"
dat = dat[dat$peak_quantile>.25,]
dat = dat %>% group_by(gage) %>% count() %>% left_join(dat,.,by="gage")
dat.metrics = dat %>% select(gage,peak2zero,drying_rate,dry_date_start,n)
scale(dat$peak_quantile)
hist(scale(dat$peak_quantile))
hist(scale(dat$dry_dur))
summary(scale(dat$dry_dur))
plot_lay <-function(){
list(
geom_density_ridges(scale=2,alpha = .75,panel_scaling = FALSE,rel_min_height=0.01),
scale_fill_manual(values = pal_regions),
# scale_color_manual(values = pal_regions),
# ylab("Mean drying event length\n(days)") ,
# xlim(0,4) ,
theme(
# panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
# Change plot and panel background
plot.background = element_blank(),
# panel.background = element_blank(),
axis.text.y = element_blank(),
axis.title.x = element_blank(),
axis.ticks.y = element_blank(),
)
)
}
sev = ggplot(data=dat, aes(x = (scale(dry_dur)*scale(peak_quantile))/n,y=Name,group=paste(Name,CLASS),fill=Name,linetype=CLASS)) +
plot_lay()
library(ggridges)
sev = ggplot(data=dat, aes(x = (scale(dry_dur)*scale(peak_quantile))/n,y=Name,group=paste(Name,CLASS),fill=Name,linetype=CLASS)) +
plot_lay()
########## Define Colors
pal_regions <-
c("Eastern Forests" = "#009E73",
"Mediterranean California" = "#F0E442",
"Northern Great Plains" = "#0072B2",
"Southern Great Plains" = "#E69F00",
"Western Deserts" = "#D55E00",
"Western Mountains" = "#56B4E9")
library(ggridges)
library(ggplot2)
library(dplyr)
library(lubridate)
library(ggpubr)
library(RColorBrewer)
library(tidyverse)
library(patchwork)
library(viridis)
dat = read.csv('../data/metrics_by_event_combined.csv')
sev = ggplot(data=dat, aes(x = (scale(dry_dur)*scale(peak_quantile))/n,y=Name,group=paste(Name,CLASS),fill=Name,linetype=CLASS)) +
plot_lay()
sev
dat = dat %>% group_by(gage) %>% count() %>% left_join(dat,.,by="gage")
dat$n
sev = ggplot(data=dat, aes(x = (scale(dry_dur)*scale(peak_quantile))/n,y=Name,group=paste(Name,CLASS),fill=Name,linetype=CLASS)) +
plot_lay()
sev
### Load Data
dat = read.csv("../data/metrics_by_event_combined.csv")
dat$Name[dat$Name == "Ignore"] = "Mediterranean California"
dat = dat[dat$peak_quantile>.25,]
dat = dat %>% group_by(gage) %>% count() %>% left_join(dat,.,by="gage")
sev = ggplot(data=dat, aes(x = (scale(dry_dur)*scale(peak_quantile))/n,y=Name,group=paste(Name,CLASS),fill=Name,linetype=CLASS)) +
plot_lay()
sev
sev = ggplot(data=dat, aes(x = (scale(dry_dur)*scale(peak_quantile))/n,y=Name,group=paste(Name,CLASS),fill=Name,linetype=CLASS)) +
plot_lay()+xlim(-5,5)
sev
sev = ggplot(data=dat, aes(x = (scale(dry_dur)*scale(peak_quantile))/n,y=Name,group=paste(Name,CLASS),fill=Name,linetype=CLASS)) +
plot_lay()+xlim(-.5,.5)
sev
